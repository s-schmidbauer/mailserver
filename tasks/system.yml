---
- name: basic system setup
  hosts: all_hosts
  user: admin
  become: true
  become_method: doas

  tasks:
  - name: "configure /etc/{{ item }}"
    template:
      src: "system/{{ item }}"
      dest: "/etc/{{ item }}"
    with_items:
      - myname
      - mygate
      - hosts
      - adduser.conf
      - login.conf
      - installurl
      - profile
    tags: sys-config

  - name: create admin user with password
    shell: pass=$(echo {{ admin_pass }} | encrypt) ; adduser -batch {{ admin_user }} wheel 'admin' $pass
    ignore_errors: true
    no_log: true
    tags: sys-config

  - name: set admin user password
    shell: pass=$(echo {{ admin_pass}} | encrypt) ; usermod -p $pass {{ admin_user }}
    no_log: true
    tags: sys-config

  - name: configure cronjobs
    cron:
      name: "{{ item.name }}"
      special_time: "{{ item.special_time }}"
      job: "{{ item.job }}"
    with_items: cronjobs
    tags: sys-config
