server "{{ fqdn }}" {
        listen on * tls port 443

        tls {
                ciphers "EECDH+AESGCM:EDH+AESGCM"
                ecdhe "P-384,P-256,X25519"
                certificate "/etc/ssl/{{ fqdn }}.fullchain.pem"
                key "/etc/ssl/private/{{ fqdn }}.key"
                ocsp "/etc/ssl/{{ fqdn }}.der"
        }

        # redirect any HTTP to the webmail on cloud
        location * {
                block return 301 "{{ webmail }}"
        }

}

server "*" {
        listen on * port 80

        location "/.well-known/acme-challenge/*" {
                root "/acme"
                request strip 2
        }
        location * {
                block return 302 "https://$HTTP_HOST$REQUEST_URI"
        }
}
